<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Connexion / Inscription â€” I-Djassa</title>
  <link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=DM+Sans:ital,wght@0,300;0,400;0,500;1,300&display=swap" rel="stylesheet" />
  <style>
    :root {
      --orange: #F4722B; --orange-light: #FF9A5C; --orange-dark: #C4511A;
      --green: #1A7A4A; --green-light: #2AAD68;
      --dark: #0F0E0C; --dark-2: #1C1A16; --dark-3: #2A2720;
      --text-muted: #8A8070; --white: #FFFFFF;
    }
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'DM Sans', sans-serif;
      background: var(--dark); color: var(--white);
      min-height: 100vh; display: flex; flex-direction: column;
    }

    .auth-layout {
      flex: 1; display: grid;
      grid-template-columns: 1fr 1fr;
      min-height: 100vh;
    }

    /* LEFT PANEL */
    .left-panel {
      background: linear-gradient(160deg, var(--orange-dark) 0%, var(--orange) 40%, #FF9A5C 100%);
      padding: 3rem; display: flex; flex-direction: column;
      justify-content: space-between; position: relative; overflow: hidden;
    }
    .left-panel::before {
      content: '';
      position: absolute; inset: 0;
      background: url("data:image/svg+xml,%3Csvg width='80' height='80' viewBox='0 0 80 80' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none'%3E%3Ccircle cx='40' cy='40' r='2' fill='white' fill-opacity='0.08'/%3E%3C/g%3E%3C/svg%3E");
    }
    .left-logo {
      font-family: 'Syne', sans-serif; font-weight: 800; font-size: 2rem;
      color: var(--white); text-decoration: none; position: relative;
    }
    .left-content { position: relative; }
    .left-content h2 {
      font-family: 'Syne', sans-serif; font-size: 2.5rem; font-weight: 800;
      line-height: 1.1; letter-spacing: -0.02em; margin-bottom: 1.2rem;
    }
    .left-content p {
      font-size: 1rem; opacity: 0.85; line-height: 1.7; margin-bottom: 2rem;
    }
    .features { display: flex; flex-direction: column; gap: 0.8rem; }
    .feature {
      display: flex; align-items: center; gap: 0.7rem;
      font-size: 0.9rem; opacity: 0.9;
    }
    .feature-icon {
      width: 32px; height: 32px; background: rgba(255,255,255,0.2);
      border-radius: 8px; display: flex; align-items: center; justify-content: center;
      font-size: 1rem; flex-shrink: 0;
    }
    .left-footer {
      font-size: 0.82rem; opacity: 0.7; position: relative;
    }

    /* RIGHT PANEL */
    .right-panel {
      background: var(--dark-2);
      display: flex; align-items: center; justify-content: center;
      padding: 3rem 2rem;
    }
    .auth-box { width: 100%; max-width: 400px; }

    /* TABS */
    .auth-tabs {
      display: flex; background: var(--dark-3);
      border-radius: 12px; padding: 4px; margin-bottom: 2rem;
    }
    .auth-tab {
      flex: 1; padding: 0.6rem; border: none; border-radius: 9px;
      background: none; color: rgba(255,255,255,0.5); font-size: 0.88rem;
      font-weight: 600; cursor: pointer; font-family: 'DM Sans', sans-serif;
      transition: all 0.2s;
    }
    .auth-tab.active { background: var(--dark-2); color: var(--white); box-shadow: 0 2px 8px rgba(0,0,0,0.3); }

    .auth-title {
      font-family: 'Syne', sans-serif; font-size: 1.5rem; font-weight: 800;
      margin-bottom: 0.3rem;
    }
    .auth-subtitle { color: var(--text-muted); font-size: 0.88rem; margin-bottom: 1.5rem; }

    /* FORM */
    .auth-form { display: flex; flex-direction: column; gap: 1rem; }
    .form-group { display: flex; flex-direction: column; gap: 0.4rem; }
    .form-label { font-size: 0.85rem; font-weight: 600; color: rgba(255,255,255,0.8); }
    .form-label .required { color: var(--orange); }

    .input-wrapper { position: relative; }
    .form-input {
      width: 100%; background: var(--dark-3);
      border: 1px solid rgba(255,255,255,0.1); border-radius: 10px;
      padding: 0.75rem 1rem; color: var(--white); font-size: 0.9rem;
      font-family: 'DM Sans', sans-serif; outline: none; transition: border-color 0.2s;
    }
    .form-input:focus { border-color: var(--orange); }
    .form-input::placeholder { color: rgba(255,255,255,0.25); }
    .input-icon {
      position: absolute; right: 1rem; top: 50%; transform: translateY(-50%);
      color: var(--text-muted); cursor: pointer; font-size: 1rem;
    }

    /* PHONE INPUT */
    .phone-wrapper { display: flex; gap: 0.5rem; }
    .country-code {
      background: var(--dark-3); border: 1px solid rgba(255,255,255,0.1);
      border-radius: 10px; padding: 0.75rem 0.8rem; color: var(--white);
      font-size: 0.9rem; font-family: 'DM Sans', sans-serif; outline: none;
      cursor: pointer; white-space: nowrap; min-width: 90px;
    }
    .country-code option { background: var(--dark-2); }

    /* OTP */
    .otp-group { display: flex; gap: 0.6rem; justify-content: center; }
    .otp-input {
      width: 48px; height: 52px; text-align: center;
      background: var(--dark-3); border: 1px solid rgba(255,255,255,0.1);
      border-radius: 10px; color: var(--white); font-size: 1.3rem; font-weight: 700;
      font-family: 'Syne', sans-serif; outline: none; transition: border-color 0.2s;
    }
    .otp-input:focus { border-color: var(--orange); }

    /* SEPARATOR */
    .auth-sep {
      display: flex; align-items: center; gap: 0.8rem;
      color: var(--text-muted); font-size: 0.8rem; margin: 0.5rem 0;
    }
    .auth-sep::before, .auth-sep::after {
      content: ''; flex: 1; height: 1px; background: rgba(255,255,255,0.08);
    }

    /* SUBMIT BTN */
    .btn-auth {
      width: 100%; padding: 0.85rem; border-radius: 100px;
      background: var(--orange); border: none; color: var(--white);
      font-size: 0.95rem; font-weight: 700; cursor: pointer;
      font-family: 'DM Sans', sans-serif; transition: all 0.2s;
      box-shadow: 0 4px 20px rgba(244,114,43,0.3);
    }
    .btn-auth:hover { background: var(--orange-dark); transform: translateY(-1px); }

    /* WHATSAPP BTN */
    .btn-whatsapp {
      width: 100%; padding: 0.75rem; border-radius: 100px;
      background: rgba(37, 211, 102, 0.12); border: 1px solid rgba(37, 211, 102, 0.25);
      color: #25D366; font-size: 0.9rem; font-weight: 600; cursor: pointer;
      font-family: 'DM Sans', sans-serif; transition: all 0.2s;
      display: flex; align-items: center; justify-content: center; gap: 0.5rem;
    }
    .btn-whatsapp:hover { background: rgba(37, 211, 102, 0.2); }

    .auth-link {
      text-align: center; font-size: 0.82rem; color: var(--text-muted); margin-top: 0.5rem;
    }
    .auth-link a { color: var(--orange); text-decoration: none; font-weight: 600; }
    .auth-link a:hover { text-decoration: underline; }

    /* CGU */
    .cgu-text {
      font-size: 0.76rem; color: var(--text-muted); text-align: center; line-height: 1.5;
    }
    .cgu-text a { color: rgba(255,255,255,0.5); text-decoration: none; }
    .cgu-text a:hover { color: var(--orange); }

    /* STEP INDICATOR */
    .step-dots {
      display: flex; justify-content: center; gap: 0.4rem; margin-bottom: 1.5rem;
    }
    .step-dot {
      width: 8px; height: 8px; border-radius: 50%;
      background: rgba(255,255,255,0.15); transition: all 0.2s;
    }
    .step-dot.active { background: var(--orange); width: 24px; border-radius: 4px; }
    .step-dot.done { background: var(--green); }

    /* PANELS */
    .auth-panel { display: none; }
    .auth-panel.show { display: block; }

    /* SMS info */
    .sms-info {
      background: rgba(244,114,43,0.08); border: 1px solid rgba(244,114,43,0.2);
      border-radius: 10px; padding: 0.8rem 1rem;
      font-size: 0.82rem; color: rgba(255,255,255,0.7); line-height: 1.5;
      display: flex; gap: 0.5rem; align-items: flex-start;
    }

    @media (max-width: 768px) {
      .auth-layout { grid-template-columns: 1fr; }
      .left-panel { display: none; }
      .right-panel { padding: 2rem 1.5rem; align-items: flex-start; padding-top: 3rem; }
    }
  </style>
</head>
<body>

<div class="auth-layout">

  <!-- LEFT PANEL -->
  <div class="left-panel">
    <a href="index.html" class="left-logo">I-Djassa</a>

    <div class="left-content">
      <h2>Achetez & vendez en toute confiance</h2>
      <p>Rejoignez le grand marchÃ© ivoirien en ligne. Des milliers d'articles, des vendeurs vÃ©rifiÃ©s, zÃ©ro arnaque.</p>
      <div class="features">
        <div class="feature">
          <div class="feature-icon">ğŸªª</div>
          <span>IdentitÃ© vÃ©rifiÃ©e par CNI ou passeport</span>
        </div>
        <div class="feature">
          <div class="feature-icon">ğŸ“„</div>
          <span>Preuves de propriÃ©tÃ© pour chaque annonce</span>
        </div>
        <div class="feature">
          <div class="feature-icon">ğŸ†“</div>
          <span>100% gratuit â€” aucun abonnement</span>
        </div>
        <div class="feature">
          <div class="feature-icon">ğŸ‡¨ğŸ‡®</div>
          <span>Plateforme 100% ivoirienne</span>
        </div>
      </div>
    </div>

    <div class="left-footer">Â© 2026 I-Djassa â€” CÃ´te d'Ivoire</div>
  </div>

  <!-- RIGHT PANEL -->
  <div class="right-panel">
    <div class="auth-box">

      <!-- TABS -->
      <div class="auth-tabs">
        <button class="auth-tab active" onclick="switchTab('login')">Connexion</button>
        <button class="auth-tab" onclick="switchTab('register')">Inscription</button>
      </div>

      <!-- LOGIN -->
      <div class="auth-panel show" id="loginPanel">
        <div class="auth-title">Bon retour ! ğŸ‘‹</div>
        <div class="auth-subtitle">Connectez-vous Ã  votre compte I-Djassa</div>

        <div class="auth-form">
          <div class="form-group">
            <label class="form-label">NumÃ©ro de tÃ©lÃ©phone <span class="required">*</span></label>
            <div class="phone-wrapper">
              <select class="country-code">
                <option value="+225">ğŸ‡¨ğŸ‡® +225</option>
                <option value="+221">ğŸ‡¸ğŸ‡³ +221</option>
                <option value="+223">ğŸ‡²ğŸ‡± +223</option>
                <option value="+226">ğŸ‡§ğŸ‡« +226</option>
                <option value="+233">ğŸ‡¬ğŸ‡­ +233</option>
              </select>
              <input type="tel" class="form-input" placeholder="07 XX XX XX XX" />
            </div>
          </div>

          <div class="form-group">
            <label class="form-label">Mot de passe <span class="required">*</span></label>
            <div class="input-wrapper">
              <input type="password" class="form-input" placeholder="Votre mot de passe" id="loginPassword" />
              <span class="input-icon" onclick="togglePassword('loginPassword')">ğŸ‘ï¸</span>
            </div>
          </div>

          <div style="text-align:right">
            <a href="#" style="color:var(--orange);font-size:0.82rem;text-decoration:none">Mot de passe oubliÃ© ?</a>
          </div>

          <button class="btn-auth" onclick="showOTP()">Se connecter â†’</button>

          <div class="auth-sep">ou</div>

          <button class="btn-whatsapp">
            <span>ğŸ’¬</span> Connexion via WhatsApp
          </button>
        </div>

        <div class="auth-link" style="margin-top:1.2rem">
          Pas encore de compte ? <a href="#" onclick="switchTab('register')">S'inscrire gratuitement</a>
        </div>
      </div>

      <!-- REGISTER -->
      <div class="auth-panel" id="registerPanel">

        <!-- STEP 1: Infos de base -->
        <div class="auth-panel show" id="regStep1">
          <div class="step-dots">
            <div class="step-dot active"></div>
            <div class="step-dot"></div>
            <div class="step-dot"></div>
          </div>

          <div class="auth-title">CrÃ©er un compte ğŸš€</div>
          <div class="auth-subtitle">Ã‰tape 1 sur 3 â€” Vos informations de base</div>

          <div class="auth-form">
            <div class="form-row" style="display:grid;grid-template-columns:1fr 1fr;gap:0.8rem">
              <div class="form-group">
                <label class="form-label">PrÃ©nom <span class="required">*</span></label>
                <input type="text" class="form-input" placeholder="KouamÃ©" />
              </div>
              <div class="form-group">
                <label class="form-label">Nom <span class="required">*</span></label>
                <input type="text" class="form-input" placeholder="Konan" />
              </div>
            </div>

            <div class="form-group">
              <label class="form-label">NumÃ©ro de tÃ©lÃ©phone <span class="required">*</span></label>
              <div class="phone-wrapper">
                <select class="country-code">
                  <option value="+225">ğŸ‡¨ğŸ‡® +225</option>
                  <option value="+221">ğŸ‡¸ğŸ‡³ +221</option>
                  <option value="+223">ğŸ‡²ğŸ‡± +223</option>
                  <option value="+226">ğŸ‡§ğŸ‡« +226</option>
                  <option value="+233">ğŸ‡¬ğŸ‡­ +233</option>
                </select>
                <input type="tel" class="form-input" placeholder="07 XX XX XX XX" />
              </div>
            </div>

            <div class="form-group">
              <label class="form-label">Mot de passe <span class="required">*</span></label>
              <div class="input-wrapper">
                <input type="password" class="form-input" placeholder="Minimum 8 caractÃ¨res" id="regPassword" />
                <span class="input-icon" onclick="togglePassword('regPassword')">ğŸ‘ï¸</span>
              </div>
            </div>

            <button class="btn-auth" onclick="showRegStep2()">Continuer â†’</button>
          </div>
        </div>

        <!-- STEP 2: VÃ©rification SMS -->
        <div class="auth-panel" id="regStep2">
          <div class="step-dots">
            <div class="step-dot done"></div>
            <div class="step-dot active"></div>
            <div class="step-dot"></div>
          </div>

          <div class="auth-title">VÃ©rification SMS ğŸ“±</div>
          <div class="auth-subtitle">Ã‰tape 2 sur 3 â€” Confirmez votre numÃ©ro</div>

          <div class="auth-form">
            <div class="sms-info">
              <span>ğŸ“¨</span>
              <span>Un code Ã  4 chiffres a Ã©tÃ© envoyÃ© au <strong>+225 07 XX XX XX XX</strong>. Valable 10 minutes.</span>
            </div>

            <div class="form-group">
              <label class="form-label" style="text-align:center">Entrez le code reÃ§u par SMS</label>
              <div class="otp-group">
                <input type="text" class="otp-input" maxlength="1" oninput="moveToNext(this, 'otp1')" id="otp0" />
                <input type="text" class="otp-input" maxlength="1" oninput="moveToNext(this, 'otp2')" id="otp1" />
                <input type="text" class="otp-input" maxlength="1" oninput="moveToNext(this, 'otp3')" id="otp2" />
                <input type="text" class="otp-input" maxlength="1" id="otp3" />
              </div>
            </div>

            <button class="btn-auth" onclick="showRegStep3()">VÃ©rifier le code â†’</button>

            <div class="auth-link">
              Pas reÃ§u ? <a href="#">Renvoyer le code</a>
            </div>
          </div>
        </div>

        <!-- STEP 3: KYC -->
        <div class="auth-panel" id="regStep3">
          <div class="step-dots">
            <div class="step-dot done"></div>
            <div class="step-dot done"></div>
            <div class="step-dot active"></div>
          </div>

          <div class="auth-title">VÃ©rification KYC ğŸªª</div>
          <div class="auth-subtitle">Ã‰tape 3 sur 3 â€” VÃ©rifiez votre identitÃ© (optionnel)</div>

          <div class="auth-form">
            <div class="sms-info" style="background:rgba(26,122,74,0.08);border-color:rgba(26,122,74,0.2)">
              <span>ğŸ›¡ï¸</span>
              <span>La vÃ©rification KYC est optionnelle mais vous donne le badge <strong>ğŸ¥ˆ VÃ©rifiÃ©</strong> et inspire confiance aux acheteurs.</span>
            </div>

            <div class="form-group">
              <label class="form-label">Type de piÃ¨ce d'identitÃ©</label>
              <select class="form-input" style="cursor:pointer">
                <option value="">Choisir</option>
                <option>Carte Nationale d'IdentitÃ© (CNI)</option>
                <option>Passeport</option>
                <option>Carte de rÃ©sident</option>
              </select>
            </div>

            <div class="form-group">
              <label class="form-label">Photo recto de la piÃ¨ce</label>
              <div style="border:2px dashed rgba(255,255,255,0.12);border-radius:10px;padding:1.2rem;text-align:center;cursor:pointer;background:var(--dark-3)" onclick="document.getElementById('cniRecto').click()">
                <input type="file" id="cniRecto" accept="image/*" style="display:none" />
                <div style="font-size:1.5rem;margin-bottom:0.3rem">ğŸªª</div>
                <div style="font-size:0.82rem;color:var(--text-muted)">Cliquez pour ajouter la photo recto</div>
              </div>
            </div>

            <div class="form-group">
              <label class="form-label">Selfie avec la piÃ¨ce d'identitÃ©</label>
              <div style="border:2px dashed rgba(255,255,255,0.12);border-radius:10px;padding:1.2rem;text-align:center;cursor:pointer;background:var(--dark-3)" onclick="document.getElementById('selfie').click()">
                <input type="file" id="selfie" accept="image/*" style="display:none" />
                <div style="font-size:1.5rem;margin-bottom:0.3rem">ğŸ¤³</div>
                <div style="font-size:0.82rem;color:var(--text-muted)">Photo de vous tenant votre CNI visible</div>
              </div>
            </div>

            <button class="btn-auth" onclick="finishRegister()">Terminer l'inscription â†’</button>

            <div class="auth-link">
              <a href="annonces.html" style="color:var(--text-muted)">Passer cette Ã©tape pour l'instant</a>
            </div>
          </div>
        </div>

        <div class="auth-link" style="margin-top:1.2rem">
          DÃ©jÃ  un compte ? <a href="#" onclick="switchTab('login')">Se connecter</a>
        </div>

        <div class="cgu-text" style="margin-top:1rem">
          En vous inscrivant, vous acceptez nos <a href="#">Conditions d'utilisation</a> et notre <a href="#">Politique de confidentialitÃ©</a>
        </div>
      </div>

    </div>
  </div>
</div>

<!-- SUCCESS -->
<div id="successOverlay" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.85);z-index:200;align-items:center;justify-content:center">
  <div style="background:var(--dark-2);border:1px solid rgba(26,122,74,0.3);border-radius:24px;padding:3rem;text-align:center;max-width:380px;animation:popIn 0.4s ease">
    <div style="font-size:4rem;margin-bottom:1rem">ğŸ‰</div>
    <div style="font-family:'Syne',sans-serif;font-size:1.5rem;font-weight:800;margin-bottom:0.5rem">Bienvenue sur I-Djassa !</div>
    <div style="color:var(--text-muted);font-size:0.9rem;line-height:1.6;margin-bottom:2rem">Votre compte est crÃ©Ã©. Vous pouvez maintenant publier vos annonces et contacter des vendeurs.</div>
    <a href="annonces.html" style="display:block;padding:0.85rem;border-radius:100px;background:var(--orange);color:var(--white);text-decoration:none;font-weight:700;font-size:0.95rem">Explorer les annonces â†’</a>
  </div>
</div>

<style>
  @keyframes popIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }
</style>

<script src="api.js"></script>
<script>
  // ========== STATE ==========
  let currentTelephone = '';
  let currentPrenom = '';
  let currentNom = '';

  // ========== REDIRECT ==========
  function getRedirect() {
    const params = new URLSearchParams(window.location.search);
    return params.get('next') || sessionStorage.getItem('idjassa_redirect') || 'annonces.html';
  }

  function redirectAfterLogin() {
    const dest = getRedirect();
    sessionStorage.removeItem('idjassa_redirect');
    window.location.href = dest;
  }

  // Si dÃ©jÃ  connectÃ© â†’ rediriger directement
  if (isLoggedIn()) redirectAfterLogin();

  // ========== TABS ==========
  function switchTab(tab) {
    document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.auth-panel[id$="Panel"]').forEach(p => p.classList.remove('show'));
    if (tab === 'login') {
      document.querySelectorAll('.auth-tab')[0].classList.add('active');
      document.getElementById('loginPanel').classList.add('show');
    } else {
      document.querySelectorAll('.auth-tab')[1].classList.add('active');
      document.getElementById('registerPanel').classList.add('show');
      showRegStep(1);
    }
  }

  function showRegStep(n) {
    document.querySelectorAll('[id^="regStep"]').forEach(p => p.classList.remove('show'));
    document.getElementById('regStep' + n).classList.add('show');
  }

  // ========== Ã‰TAPE 1 â†’ 2 (PrÃ©nom/Nom) ==========
  function showRegStep2() {
    const prenom = document.querySelector('#regStep1 input[placeholder="KouamÃ©"]')?.value?.trim() || '';
    const nom    = document.querySelector('#regStep1 input[placeholder="Konan"]')?.value?.trim() || '';
    if (!prenom || !nom) { showError('Veuillez renseigner votre prÃ©nom et nom.'); return; }
    currentPrenom = prenom;
    currentNom = nom;
    showRegStep(2);
  }

  // ========== Ã‰TAPE 2 â†’ ENVOI OTP (TÃ©lÃ©phone) ==========
  async function showRegStep3() {
    const tel = document.querySelector('#regStep2 input[type="tel"]')?.value?.trim() || '';
    if (!tel || tel.length < 8) { showError('Veuillez entrer un numÃ©ro valide.'); return; }

    // Formater le numÃ©ro ivoirien
    currentTelephone = tel.startsWith('+') ? tel : '+225' + tel.replace(/^0/, '');

    const btn = document.querySelector('#regStep2 .auth-btn');
    btn.textContent = 'â³ Envoi en cours...';
    btn.disabled = true;

    try {
      await Auth.sendOtp(currentTelephone);
      showRegStep(3);
      btn.textContent = 'Continuer â†’';
      btn.disabled = false;
    } catch (err) {
      // Fallback : passer quand mÃªme Ã  l'Ã©tape suivante (SMS pas encore configurÃ©)
      console.warn('SMS non disponible, passage en mode dÃ©mo');
      showRegStep(3);
      btn.textContent = 'Continuer â†’';
      btn.disabled = false;
    }
  }

  // ========== INSCRIPTION TERMINÃ‰E ==========
  async function finishRegister() {
    const code = ['otp0','otp1','otp2','otp3'].map(id => document.getElementById(id)?.value || '').join('');
    if (code.length < 4) { showError('Veuillez entrer le code Ã  4 chiffres.'); return; }

    const btn = document.querySelector('#regStep3 .auth-btn');
    btn.textContent = 'â³ CrÃ©ation du compte...';
    btn.disabled = true;

    try {
      await Auth.verifyOtp({
        telephone: currentTelephone,
        code,
        prenom: currentPrenom,
        nom: currentNom
      });

      // SuccÃ¨s â†’ afficher popup
      document.getElementById('successOverlay').style.display = 'flex';
      setTimeout(() => redirectAfterLogin(), 3000);

    } catch (err) {
      // Fallback dÃ©mo si API indisponible
      saveSession('demo-token', {
        prenom: currentPrenom, nom: currentNom,
        telephone: currentTelephone, badge: 'bronze', role: 'user'
      });
      document.getElementById('successOverlay').style.display = 'flex';
      setTimeout(() => redirectAfterLogin(), 3000);
    }

    btn.textContent = 'Terminer l\'inscription';
    btn.disabled = false;
  }

  // ========== CONNEXION ==========
  async function showOTP() {
    const tel = document.querySelector('#loginPanel input[type="tel"]')?.value?.trim() || '';
    if (!tel) { showError('Veuillez entrer votre numÃ©ro.'); return; }

    const telephone = tel.startsWith('+') ? tel : '+225' + tel.replace(/^0/, '');
    currentTelephone = telephone;

    const btn = document.querySelector('#loginPanel .auth-btn');
    btn.textContent = 'â³ Connexion...';
    btn.disabled = true;

    try {
      // En prod : envoyer OTP et attendre code
      // Pour l'instant : connexion directe avec code "0000" (dÃ©mo)
      await Auth.verifyOtp({ telephone, code: '0000' });
      redirectAfterLogin();
    } catch (err) {
      // Fallback dÃ©mo
      saveSession('demo-token', {
        prenom: 'Utilisateur', nom: '',
        telephone, badge: 'bronze', role: 'user'
      });
      redirectAfterLogin();
    }

    btn.textContent = 'Se connecter â†’';
    btn.disabled = false;
  }

  // ========== UTILITAIRES ==========
  function showError(msg) {
    showToast(msg, 'error');
  }

  function togglePassword(id) {
    const input = document.getElementById(id);
    input.type = input.type === 'password' ? 'text' : 'password';
  }

  function moveToNext(el, nextId) {
    if (el.value.length === 1) {
      const next = document.getElementById(nextId);
      if (next) next.focus();
    }
  }

  // Afficher le message si redirigÃ© depuis une page protÃ©gÃ©e
  window.addEventListener('DOMContentLoaded', () => {
    const params = new URLSearchParams(window.location.search);
    if (params.get('next')) {
      const banner = document.createElement('div');
      banner.style.cssText = `
        background: rgba(244,114,43,0.1); border: 1px solid rgba(244,114,43,0.25);
        border-radius: 10px; padding: 0.8rem 1rem; margin-bottom: 1rem;
        font-size: 0.85rem; color: rgba(255,255,255,0.8);
        display: flex; gap: 0.5rem; align-items: center;
      `;
      banner.innerHTML = 'ğŸ”’ Connectez-vous pour accÃ©der Ã  cette fonctionnalitÃ©.';
      const box = document.querySelector('.auth-box');
      if (box) box.insertBefore(banner, box.firstChild);
    }
  });
</script>
</body>
</html>
