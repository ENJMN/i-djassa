<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Annonces ‚Äî I-Djassa</title>
  <link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=DM+Sans:ital,wght@0,300;0,400;0,500;1,300&display=swap" rel="stylesheet" />
  <style>
    :root {
      --orange: #F4722B;
      --orange-light: #FF9A5C;
      --orange-dark: #C4511A;
      --green: #1A7A4A;
      --green-light: #2AAD68;
      --dark: #0F0E0C;
      --dark-2: #1C1A16;
      --dark-3: #2A2720;
      --text-muted: #8A8070;
      --white: #FFFFFF;
    }
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'DM Sans', sans-serif; background: var(--dark); color: var(--white); }

    /* NAV */
    nav {
      position: sticky; top: 0; z-index: 100;
      display: flex; align-items: center; justify-content: space-between;
      padding: 1rem 2rem;
      background: rgba(15,14,12,0.95);
      backdrop-filter: blur(16px);
      border-bottom: 1px solid rgba(244,114,43,0.15);
    }
    .logo { font-family: 'Syne', sans-serif; font-weight: 800; font-size: 1.4rem; text-decoration: none; }
    .logo .i { color: var(--orange); }
    .logo .d { color: var(--white); }
    .nav-right { display: flex; align-items: center; gap: 1rem; }
    .nav-search {
      display: flex; align-items: center;
      background: rgba(255,255,255,0.07);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 100px;
      padding: 0.45rem 0.45rem 0.45rem 1rem;
      gap: 0.5rem; width: 300px;
    }
    .nav-search input {
      background: none; border: none; outline: none;
      color: var(--white); font-size: 0.88rem; font-family: 'DM Sans', sans-serif; width: 100%;
    }
    .nav-search input::placeholder { color: rgba(255,255,255,0.3); }
    .search-btn-sm {
      background: var(--orange); border: none; border-radius: 100px;
      padding: 0.4rem 1rem; color: var(--white); font-size: 0.82rem;
      font-weight: 600; cursor: pointer; white-space: nowrap;
      font-family: 'DM Sans', sans-serif;
    }
    .btn-publier {
      background: var(--orange); color: var(--white); border: none;
      padding: 0.55rem 1.2rem; border-radius: 100px;
      font-size: 0.88rem; font-weight: 600; cursor: pointer;
      text-decoration: none; white-space: nowrap;
      transition: background 0.2s;
    }
    .btn-publier:hover { background: var(--orange-dark); }

    /* LAYOUT */
    .page-layout {
      display: grid;
      grid-template-columns: 260px 1fr;
      gap: 0;
      min-height: calc(100vh - 60px);
    }

    /* SIDEBAR FILTRES */
    .sidebar {
      background: var(--dark-2);
      border-right: 1px solid rgba(255,255,255,0.06);
      padding: 1.5rem;
      position: sticky;
      top: 60px;
      height: calc(100vh - 60px);
      overflow-y: auto;
    }

    .filter-section { margin-bottom: 2rem; }
    .filter-title {
      font-family: 'Syne', sans-serif;
      font-size: 0.8rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: var(--text-muted);
      margin-bottom: 0.8rem;
    }

    .filter-btn {
      display: flex; align-items: center; gap: 0.6rem;
      width: 100%; padding: 0.6rem 0.8rem;
      background: none; border: none; border-radius: 10px;
      color: rgba(255,255,255,0.7); font-size: 0.88rem;
      font-family: 'DM Sans', sans-serif;
      cursor: pointer; text-align: left;
      transition: all 0.15s;
    }
    .filter-btn:hover { background: rgba(255,255,255,0.06); color: var(--white); }
    .filter-btn.active { background: rgba(244,114,43,0.12); color: var(--orange); }
    .filter-btn .icon { font-size: 1.1rem; }
    .filter-count {
      margin-left: auto; font-size: 0.75rem;
      background: rgba(255,255,255,0.08);
      padding: 0.1rem 0.5rem; border-radius: 100px;
      color: var(--text-muted);
    }

    .price-range {
      display: flex; gap: 0.5rem; align-items: center;
    }
    .price-input {
      flex: 1; background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 8px; padding: 0.5rem 0.7rem;
      color: var(--white); font-size: 0.85rem;
      font-family: 'DM Sans', sans-serif; outline: none;
      transition: border-color 0.2s;
    }
    .price-input:focus { border-color: var(--orange); }
    .price-sep { color: var(--text-muted); font-size: 0.8rem; }

    .ville-select {
      width: 100%;
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 8px; padding: 0.55rem 0.8rem;
      color: var(--white); font-size: 0.88rem;
      font-family: 'DM Sans', sans-serif; outline: none;
      cursor: pointer; transition: border-color 0.2s;
    }
    .ville-select:focus { border-color: var(--orange); }
    .ville-select option { background: var(--dark-2); }

    .trust-filter { display: flex; flex-direction: column; gap: 0.5rem; }
    .trust-option {
      display: flex; align-items: center; gap: 0.6rem;
      cursor: pointer; font-size: 0.88rem; color: rgba(255,255,255,0.7);
    }
    .trust-option input { accent-color: var(--orange); cursor: pointer; }

    .apply-btn {
      width: 100%; padding: 0.7rem;
      background: var(--orange); border: none; border-radius: 10px;
      color: var(--white); font-weight: 600; font-size: 0.9rem;
      font-family: 'DM Sans', sans-serif; cursor: pointer;
      transition: background 0.2s; margin-top: 0.5rem;
    }
    .apply-btn:hover { background: var(--orange-dark); }

    /* MAIN CONTENT */
    .main-content { padding: 1.5rem 2rem; }

    .results-header {
      display: flex; align-items: center; justify-content: space-between;
      margin-bottom: 1.5rem; flex-wrap: wrap; gap: 1rem;
    }

    .results-info h2 {
      font-family: 'Syne', sans-serif;
      font-size: 1.3rem; font-weight: 700;
    }
    .results-info p { color: var(--text-muted); font-size: 0.85rem; margin-top: 0.2rem; }

    .sort-select {
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 8px; padding: 0.5rem 1rem;
      color: var(--white); font-size: 0.85rem;
      font-family: 'DM Sans', sans-serif; outline: none; cursor: pointer;
    }
    .sort-select option { background: var(--dark-2); }

    /* ACTIVE FILTERS */
    .active-filters { display: flex; gap: 0.5rem; flex-wrap: wrap; margin-bottom: 1.2rem; }
    .filter-tag {
      display: inline-flex; align-items: center; gap: 0.4rem;
      background: rgba(244,114,43,0.12);
      border: 1px solid rgba(244,114,43,0.25);
      color: var(--orange-light); border-radius: 100px;
      padding: 0.3rem 0.8rem; font-size: 0.78rem; font-weight: 500;
      cursor: pointer; transition: all 0.15s;
    }
    .filter-tag:hover { background: rgba(244,114,43,0.2); }
    .filter-tag .remove { font-size: 0.9rem; opacity: 0.7; }

    /* ANNONCES GRID */
    .annonces-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
      gap: 1rem;
    }

    .annonce-card {
      background: var(--dark-2);
      border: 1px solid rgba(255,255,255,0.06);
      border-radius: 14px; overflow: hidden;
      transition: all 0.25s; cursor: pointer;
      text-decoration: none; color: var(--white);
      display: block;
    }
    .annonce-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 16px 40px rgba(0,0,0,0.3);
      border-color: rgba(244,114,43,0.25);
    }

    .annonce-img {
      width: 100%; height: 160px;
      background: var(--dark-3);
      display: flex; align-items: center; justify-content: center;
      font-size: 3rem; position: relative;
    }

    .annonce-img .fav-btn {
      position: absolute; top: 0.6rem; right: 0.6rem;
      background: rgba(0,0,0,0.5); border: none;
      border-radius: 50%; width: 32px; height: 32px;
      display: flex; align-items: center; justify-content: center;
      cursor: pointer; font-size: 0.9rem; transition: all 0.2s;
    }
    .annonce-img .fav-btn:hover { background: rgba(244,114,43,0.8); }

    .annonce-badge-img {
      position: absolute; bottom: 0.6rem; left: 0.6rem;
      display: inline-flex; align-items: center; gap: 0.2rem;
      padding: 0.2rem 0.5rem; border-radius: 100px;
      font-size: 0.68rem; font-weight: 600;
    }
    .badge-gold-img { background: rgba(255,215,0,0.9); color: #7A5500; }
    .badge-silver-img { background: rgba(192,192,192,0.9); color: #333; }
    .badge-bronze-img { background: rgba(205,127,50,0.9); color: #FFF; }

    .annonce-body { padding: 0.9rem; }
    .annonce-cat {
      font-size: 0.7rem; color: var(--orange);
      font-weight: 600; text-transform: uppercase;
      letter-spacing: 0.08em; margin-bottom: 0.3rem;
    }
    .annonce-title {
      font-weight: 600; font-size: 0.9rem;
      line-height: 1.3; margin-bottom: 0.6rem;
      display: -webkit-box; -webkit-line-clamp: 2;
      -webkit-box-orient: vertical; overflow: hidden;
    }
    .annonce-price {
      font-family: 'Syne', sans-serif;
      font-size: 1.05rem; font-weight: 700; color: var(--orange);
    }
    .annonce-footer {
      display: flex; align-items: center; justify-content: space-between;
      margin-top: 0.7rem; padding-top: 0.7rem;
      border-top: 1px solid rgba(255,255,255,0.06);
    }
    .annonce-loc {
      font-size: 0.75rem; color: var(--text-muted);
      display: flex; align-items: center; gap: 0.2rem;
    }
    .annonce-time { font-size: 0.72rem; color: var(--text-muted); }

    /* PAGINATION */
    .pagination {
      display: flex; align-items: center; justify-content: center;
      gap: 0.5rem; margin-top: 3rem; padding-bottom: 2rem;
    }
    .page-btn {
      width: 38px; height: 38px; border-radius: 10px;
      border: 1px solid rgba(255,255,255,0.1);
      background: none; color: rgba(255,255,255,0.6);
      font-size: 0.88rem; cursor: pointer;
      font-family: 'DM Sans', sans-serif;
      transition: all 0.15s; display: flex;
      align-items: center; justify-content: center;
    }
    .page-btn:hover { background: rgba(255,255,255,0.06); color: var(--white); }
    .page-btn.active { background: var(--orange); color: var(--white); border-color: var(--orange); }

    /* EMPTY STATE */
    .empty-state {
      text-align: center; padding: 4rem 2rem;
      grid-column: 1 / -1;
    }
    .empty-icon { font-size: 3rem; margin-bottom: 1rem; }
    .empty-title { font-family: 'Syne', sans-serif; font-size: 1.2rem; font-weight: 700; margin-bottom: 0.5rem; }
    .empty-desc { color: var(--text-muted); font-size: 0.9rem; }

    @media (max-width: 768px) {
      .page-layout { grid-template-columns: 1fr; }
      .sidebar { position: static; height: auto; }
      nav { padding: 0.8rem 1rem; }
      .nav-search { display: none; }
      .main-content { padding: 1rem; }
    }
  </style>
</head>
<body>

<!-- NAV -->
<nav>
  <a href="index.html" class="logo"><span class="i">I-</span><span class="d">Djassa</span></a>
  <div class="nav-search">
    <input type="text" placeholder="Rechercher..." id="searchInput" />
    <button class="search-btn-sm" onclick="filterAnnonces()">üîç</button>
  </div>
  <div class="nav-right">
    <a href="inscription.html" style="color: rgba(255,255,255,0.6); text-decoration: none; font-size: 0.88rem;">Connexion</a>
    <a href="publier.html" class="btn-publier">+ Publier</a>
  </div>
</nav>

<div class="page-layout">

  <!-- SIDEBAR -->
  <aside class="sidebar">

    <div class="filter-section">
      <div class="filter-title">Cat√©gories</div>
      <button class="filter-btn active" onclick="setCategory(this, 'all')">
        <span class="icon">üè™</span> Toutes les cat√©gories
        <span class="filter-count">24</span>
      </button>
      <button class="filter-btn" onclick="setCategory(this, 'tel')">
        <span class="icon">üì±</span> T√©l√©phones
        <span class="filter-count">8</span>
      </button>
      <button class="filter-btn" onclick="setCategory(this, 'info')">
        <span class="icon">üíª</span> Informatique
        <span class="filter-count">4</span>
      </button>
      <button class="filter-btn" onclick="setCategory(this, 'elec')">
        <span class="icon">üì∫</span> √âlectrom√©nager
        <span class="filter-count">5</span>
      </button>
      <button class="filter-btn" onclick="setCategory(this, 'mode')">
        <span class="icon">üëó</span> Mode
        <span class="filter-count">3</span>
      </button>
      <button class="filter-btn" onclick="setCategory(this, 'auto')">
        <span class="icon">üöó</span> V√©hicules
        <span class="filter-count">2</span>
      </button>
      <button class="filter-btn" onclick="setCategory(this, 'mob')">
        <span class="icon">üõãÔ∏è</span> Mobilier
        <span class="filter-count">2</span>
      </button>
    </div>

    <div class="filter-section">
      <div class="filter-title">Ville</div>
      <select class="ville-select" id="villeFilter">
        <option value="">Toute la C√¥te d'Ivoire</option>
        <option value="abidjan">Abidjan</option>
        <option value="bouake">Bouak√©</option>
        <option value="yamoussoukro">Yamoussoukro</option>
        <option value="san-pedro">San-P√©dro</option>
        <option value="korhogo">Korhogo</option>
        <option value="daloa">Daloa</option>
      </select>
    </div>

    <div class="filter-section">
      <div class="filter-title">Prix (FCFA)</div>
      <div class="price-range">
        <input type="number" class="price-input" placeholder="Min" id="priceMin" />
        <span class="price-sep">‚Äî</span>
        <input type="number" class="price-input" placeholder="Max" id="priceMax" />
      </div>
    </div>

    <div class="filter-section">
      <div class="filter-title">Niveau de confiance</div>
      <div class="trust-filter">
        <label class="trust-option">
          <input type="checkbox" id="goldFilter" /> ü•á Vendeur certifi√©
        </label>
        <label class="trust-option">
          <input type="checkbox" id="silverFilter" /> ü•à Vendeur v√©rifi√©
        </label>
        <label class="trust-option">
          <input type="checkbox" id="bronzeFilter" /> ü•â Vendeur basique
        </label>
      </div>
    </div>

    <button class="apply-btn" onclick="filterAnnonces()">Appliquer les filtres</button>

  </aside>

  <!-- CONTENU PRINCIPAL -->
  <main class="main-content">

    <div class="results-header">
      <div class="results-info">
        <h2>Annonces r√©centes</h2>
        <p id="resultsCount">24 annonces trouv√©es</p>
      </div>
      <select class="sort-select" id="sortSelect" onchange="filterAnnonces()">
        <option value="recent">Plus r√©centes</option>
        <option value="price-asc">Prix croissant</option>
        <option value="price-desc">Prix d√©croissant</option>
        <option value="trust">Niveau de confiance</option>
      </select>
    </div>

    <div class="active-filters" id="activeFilters"></div>

    <div class="annonces-grid" id="annoncesGrid">
      <!-- Annonces g√©n√©r√©es par JS -->
    </div>

    <div class="pagination" id="pagination"></div>

  </main>
</div>

<script src="api.js"></script>
<script>
  let currentCategory = 'all';
  let currentPage = 1;
  let totalAnnonces = 0;
  const perPage = 12;

  // Lire les params URL (ex: annonces.html?cat=info)
  const urlParams = new URLSearchParams(window.location.search);
  if (urlParams.get('cat')) currentCategory = urlParams.get('cat');
  if (urlParams.get('q')) document.getElementById('searchInput').value = urlParams.get('q');

  function getBadgeHTML(badge) {
    if (badge === 'gold')   return '<span class="annonce-badge-img badge-gold-img">ü•á Certifi√©</span>';
    if (badge === 'silver') return '<span class="annonce-badge-img badge-silver-img">ü•à V√©rifi√©</span>';
    return '<span class="annonce-badge-img badge-bronze-img">ü•â Basique</span>';
  }

  function setCategory(btn, cat) {
    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    currentCategory = cat;
    currentPage = 1;
    loadAnnonces();
  }

  async function loadAnnonces() {
    const grid = document.getElementById('annoncesGrid');
    grid.innerHTML = `<div style="grid-column:1/-1;text-align:center;padding:3rem;color:var(--text-muted)">
      <div style="font-size:2rem;margin-bottom:0.5rem">‚è≥</div>Chargement...</div>`;

    try {
      const data = await Annonces.getAll({
        cat:      currentCategory !== 'all' ? currentCategory : undefined,
        ville:    document.getElementById('villeFilter').value || undefined,
        q:        document.getElementById('searchInput').value || undefined,
        min_prix: document.getElementById('priceMin').value || undefined,
        max_prix: document.getElementById('priceMax').value || undefined,
        badge:    getBadgeFilter(),
        sort:     document.getElementById('sortSelect').value,
        page:     currentPage
      });

      totalAnnonces = data.total;
      renderGrid(data.annonces);
      renderPagination(data.total);
      document.getElementById('resultsCount').textContent =
        data.total + ' annonce' + (data.total > 1 ? 's' : '') + ' trouv√©e' + (data.total > 1 ? 's' : '');

    } catch (err) {
      grid.innerHTML = `<div style="grid-column:1/-1;text-align:center;padding:3rem;color:var(--text-muted)">
        <div style="font-size:2rem;margin-bottom:0.5rem">‚ö†Ô∏è</div>
        Impossible de charger les annonces.<br/>
        <span style="font-size:0.8rem">${err.message}</span>
      </div>`;
    }
  }

  function getBadgeFilter() {
    const gold   = document.getElementById('goldFilter').checked;
    const silver = document.getElementById('silverFilter').checked;
    const bronze = document.getElementById('bronzeFilter').checked;
    if (gold)   return 'gold';
    if (silver) return 'silver';
    if (bronze) return 'bronze';
    return undefined;
  }

  function filterAnnonces() {
    currentPage = 1;
    loadAnnonces();
  }

  function renderGrid(annonces) {
    const grid = document.getElementById('annoncesGrid');

    if (!annonces.length) {
      grid.innerHTML = `<div class="empty-state">
        <div class="empty-icon">üîç</div>
        <div class="empty-title">Aucune annonce trouv√©e</div>
        <div class="empty-desc">Essayez d'autres crit√®res de recherche</div>
      </div>`;
      return;
    }

    grid.innerHTML = annonces.map(a => `
      <a class="annonce-card" href="annonce-detail.html?id=${a.id}">
        <div class="annonce-img">
          ${a.photo_principale
            ? `<img src="${a.photo_principale}" alt="${a.titre}" style="width:100%;height:100%;object-fit:cover"/>`
            : `<span style="font-size:3rem">${a.categorie_emoji || 'üì¶'}</span>`}
          <button class="fav-btn" onclick="event.preventDefault()">ü§ç</button>
          ${getBadgeHTML(a.vendeur_badge)}
        </div>
        <div class="annonce-body">
          <div class="annonce-cat">${a.categorie_emoji} ${a.categorie_nom}</div>
          <div class="annonce-title">${a.titre}</div>
          <div class="annonce-price">${formatPrix(a.prix)}${a.negociable ? ' <span style="font-size:0.7rem;color:var(--green-light)">N√©g.</span>' : ''}</div>
          <div class="annonce-footer">
            <span class="annonce-loc">üìç ${a.ville}</span>
            <span class="annonce-time">${timeAgo(a.created_at)}</span>
          </div>
        </div>
      </a>
    `).join('');
  }

  function renderPagination(total) {
    const pages = Math.ceil(total / perPage);
    const pag = document.getElementById('pagination');
    if (pages <= 1) { pag.innerHTML = ''; return; }

    let html = `<button class="page-btn" onclick="changePage(${currentPage-1})" ${currentPage===1?'disabled':''}>‚Üê</button>`;
    for (let i = 1; i <= pages; i++) {
      html += `<button class="page-btn ${i===currentPage?'active':''}" onclick="changePage(${i})">${i}</button>`;
    }
    html += `<button class="page-btn" onclick="changePage(${currentPage+1})" ${currentPage===pages?'disabled':''}>‚Üí</button>`;
    pag.innerHTML = html;
  }

  function changePage(p) {
    const pages = Math.ceil(totalAnnonces / perPage);
    if (p < 1 || p > pages) return;
    currentPage = p;
    loadAnnonces();
    window.scrollTo(0, 0);
  }

  // Init
  loadAnnonces();
</script>
</body>
</html>
